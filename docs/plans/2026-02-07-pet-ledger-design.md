# èŒå® è´¦æœ¬ (Pet Ledger) æŠ€æœ¯è®¾è®¡æ–‡æ¡£

> ç”Ÿæˆæ—¥æœŸ: 2026-02-07  
> æ ¸å¿ƒç†å¿µ: "è®°è´¦ä¸åªæ˜¯è®°å½•æ•°å­—ï¼Œè€Œæ˜¯ä½ åœ¨å–‚å…»ä½ çš„ç”µå­å® ç‰©"

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 äº§å“å®šä½

ä¸€æ¬¾é¢å‘å¹´è½»å¥³æ€§çš„èŒç³»è®°è´¦ Appï¼Œé€šè¿‡å® ç‰©å…»æˆéšå–»è®©è®°è´¦å˜å¾—æœ‰è¶£ï¼š
- **èµ„äº§ = å® ç‰©çš„å£ç²®/èƒ½é‡**ï¼šçœé’±è®©å® ç‰©å¼€å¿ƒã€å˜èƒ–ï¼›ä¹±èŠ±é’±è®©å® ç‰©å˜ç˜¦ã€æµæ³ª
- **è®°è´¦ = å–‚é£Ÿ/äº’åŠ¨**ï¼šæ¯ä¸€æ¬¡è®°è´¦éƒ½æ˜¯ä¸å® ç‰©çš„äº’åŠ¨

### 1.2 æŠ€æœ¯é€‰å‹

| é¡¹ç›® | å†³å®š |
|------|------|
| **å¹³å°** | Flutter è·¨å¹³å° |
| **èŒƒå›´** | å…¨åŠŸèƒ½ + AI è¯­éŸ³å°ç»„ä»¶ |
| **è¯­éŸ³è¯†åˆ«** | ç³»ç»Ÿæœ¬åœ° ASR |
| **å¤§æ¨¡å‹** | è±†åŒ… DeepSeek API |
| **æœ¬åœ°å­˜å‚¨** | SQLite (drift) |
| **äº‘ç«¯åŒæ­¥** | é˜¿é‡Œäº‘ç›˜ OAuthï¼Œæ¯å°æ—¶è¦†ç›–å¤‡ä»½ |
| **å® ç‰©åŠ¨ç”»** | Lottieï¼ŒçŒ«/ç‹—/å…”éšæœºå‡ºç° |
| **å°ç»„ä»¶** | ä»… Android |

### 1.3 åˆ†ç±»ä½“ç³»

**æ”¯å‡ºå¤§ç±» (10ä¸ª)**ï¼šé¤é¥®ã€äº¤é€šã€è´­ç‰©ã€å¨±ä¹ã€ç”Ÿæ´»ã€åŒ»ç–—ã€ç¾å¦†æŠ¤è‚¤ã€äººæƒ…ç¤¾äº¤ã€æ—…è¡Œã€å…¶ä»–

**æ”¶å…¥åˆ†ç±» (4ä¸ª)**ï¼šå·¥èµ„ã€çº¢åŒ…ã€æŠ¥é”€ã€å…¶ä»–

**åˆ†ç±»é€»è¾‘**ï¼šLLM è¿”å›ç»†åˆ†ç±»åˆ« (category) + å¤§ç±» (type)ï¼Œå›¾æ ‡æŒ‰å¤§ç±»æ˜¾ç¤º

---

## 2. æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      èŒå® è´¦æœ¬ App                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI Layer (Flutter)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  é¦–é¡µ    â”‚  â”‚  ç»Ÿè®¡    â”‚  â”‚  è®¾ç½®    â”‚  â”‚ è¯­éŸ³æµ®çª—  â”‚    â”‚
â”‚  â”‚ HomePage â”‚  â”‚ StatsPageâ”‚  â”‚ Settings â”‚  â”‚ VoiceSheetâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  State Management (Riverpod)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ TransactionPod  â”‚  â”‚   PetStatePod   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Service Layer                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ è¯­éŸ³è¯†åˆ«  â”‚  â”‚ LLMè§£æ  â”‚  â”‚ æœ¬åœ°å­˜å‚¨  â”‚  â”‚ äº‘ç›˜åŒæ­¥  â”‚    â”‚
â”‚  â”‚ ASR      â”‚  â”‚ DeepSeek â”‚  â”‚ SQLite   â”‚  â”‚ AliDrive â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Android Widget (Kotlin)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  è¯­éŸ³å°ç»„ä»¶ â†’ è°ƒç”¨ Flutter MethodChannel â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæŠ€æœ¯æ ˆï¼š**
- **çŠ¶æ€ç®¡ç†**ï¼šRiverpod
- **æœ¬åœ°æ•°æ®åº“**ï¼šdrift (SQLite çš„ Dart å°è£…ï¼Œç±»å‹å®‰å…¨)
- **ç½‘ç»œè¯·æ±‚**ï¼šdio
- **åŠ¨ç”»**ï¼šlottie + flutter åŸç”ŸåŠ¨ç”»
- **å°ç»„ä»¶é€šä¿¡**ï¼šhome_widget åŒ… + MethodChannel

---

## 3. é¡¹ç›®ç›®å½•ç»“æ„

```
lib/
â”œâ”€â”€ main.dart                     # åº”ç”¨å…¥å£
â”œâ”€â”€ app.dart                      # MaterialApp é…ç½®ã€ä¸»é¢˜ã€è·¯ç”±
â”‚
â”œâ”€â”€ core/                         # æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ theme/                    # é©¬å¡é¾™è‰²ç³»ä¸»é¢˜
â”‚   â”‚   â”œâ”€â”€ colors.dart           # å¥¶æ²¹é»„ã€æ¨±èŠ±ç²‰ã€å¤©ç©ºè“
â”‚   â”‚   â””â”€â”€ text_styles.dart
â”‚   â”œâ”€â”€ constants/                # å¸¸é‡
â”‚   â”‚   â”œâ”€â”€ categories.dart       # 10ä¸ªå¤§ç±»å®šä¹‰ + å›¾æ ‡æ˜ å°„
â”‚   â”‚   â””â”€â”€ pet_prompts.dart      # å® ç‰©å°è¯åº“ï¼ˆè¿½é—®ã€äº’åŠ¨ï¼‰
â”‚   â””â”€â”€ utils/                    # å·¥å…·ç±»
â”‚       â”œâ”€â”€ date_helper.dart      # "ä»Šå¤©"ã€"æ˜¨å¤©"æ ¼å¼åŒ–
â”‚       â””â”€â”€ haptic.dart           # éœ‡åŠ¨åé¦ˆå°è£…
â”‚
â”œâ”€â”€ data/                         # æ•°æ®å±‚
â”‚   â”œâ”€â”€ database/                 # SQLite (drift)
â”‚   â”‚   â”œâ”€â”€ app_database.dart     # æ•°æ®åº“å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ tables/               # è¡¨å®šä¹‰
â”‚   â”‚   â””â”€â”€ daos/                 # æ•°æ®è®¿é—®å¯¹è±¡
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ transaction.dart      # è´¦å•è®°å½•
â”‚   â”‚   â”œâ”€â”€ category.dart         # åˆ†ç±»
â”‚   â”‚   â””â”€â”€ budget.dart           # é¢„ç®—
â”‚   â””â”€â”€ repositories/             # ä»“åº“å±‚
â”‚       â””â”€â”€ transaction_repo.dart
â”‚
â”œâ”€â”€ services/                     # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ speech_service.dart       # æœ¬åœ°è¯­éŸ³è¯†åˆ«
â”‚   â”œâ”€â”€ llm_service.dart          # DeepSeek API è°ƒç”¨
â”‚   â”œâ”€â”€ sync_service.dart         # é˜¿é‡Œäº‘ç›˜åŒæ­¥
â”‚   â””â”€â”€ notification_service.dart # å®šæ—¶åŒæ­¥è°ƒåº¦
â”‚
â”œâ”€â”€ providers/                    # Riverpod çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ transaction_provider.dart
â”‚   â”œâ”€â”€ pet_provider.dart         # å® ç‰©çŠ¶æ€ã€å¿ƒæƒ…
â”‚   â”œâ”€â”€ budget_provider.dart
â”‚   â””â”€â”€ sync_provider.dart
â”‚
â”œâ”€â”€ pages/                        # é¡µé¢
â”‚   â”œâ”€â”€ home/                     # é¦–é¡µ
â”‚   â”œâ”€â”€ stats/                    # ç»Ÿè®¡
â”‚   â”œâ”€â”€ settings/                 # è®¾ç½®
â”‚   â””â”€â”€ voice/                    # è¯­éŸ³æµ®çª—
â”‚
â”œâ”€â”€ widgets/                      # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ pet/                      # å® ç‰©ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ pet_card.dart         # å® ç‰©äº’åŠ¨å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ pet_animation.dart    # Lottie åŠ¨ç”»æ§åˆ¶
â”‚   â”‚   â””â”€â”€ speech_bubble.dart    # æ°”æ³¡æ–‡æ¡ˆ
â”‚   â”œâ”€â”€ transaction/              # è´¦å•ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ transaction_tile.dart # åˆ—è¡¨é¡¹
â”‚   â”‚   â””â”€â”€ amount_keyboard.dart  # æ•°å­—é”®ç›˜
â”‚   â””â”€â”€ charts/                   # å›¾è¡¨
â”‚       â”œâ”€â”€ donut_chart.dart      # ç”œç”œåœˆå›¾
â”‚       â””â”€â”€ mood_banner.dart      # æƒ…ç»ªæ€»è¯„
â”‚
android/
â”œâ”€â”€ app/src/main/kotlin/.../      # Android å°ç»„ä»¶ (Kotlin)
â”‚   â”œâ”€â”€ PetWidget.kt              # å°ç»„ä»¶ UI
â”‚   â””â”€â”€ VoiceWidgetReceiver.kt    # ç‚¹å‡»äº‹ä»¶å¤„ç†
â”‚
assets/
â”œâ”€â”€ lottie/                       # Lottie åŠ¨ç”»æ–‡ä»¶
â”‚   â”œâ”€â”€ cat/                      # çŒ«å’ªåŠ¨ç”»é›†
â”‚   â”œâ”€â”€ dog/                      # ç‹—ç‹—åŠ¨ç”»é›†
â”‚   â””â”€â”€ rabbit/                   # å…”å­åŠ¨ç”»é›†
â”œâ”€â”€ icons/                        # åˆ†ç±»å›¾æ ‡
â””â”€â”€ sounds/                       # éŸ³æ•ˆï¼ˆæ°”æ³¡éŸ³ã€æ”¶é“¶æœºï¼‰
```

---

## 4. æ•°æ®æ¨¡å‹è®¾è®¡

### 4.1 æ ¸å¿ƒè¡¨ç»“æ„

```dart
// 1. è´¦å•è®°å½•è¡¨ (transactions)
class Transaction {
  int id;                    // ä¸»é”®
  double amount;             // é‡‘é¢
  bool isExpense;            // true=æ”¯å‡º, false=æ”¶å…¥
  String category;           // ç»†åˆ†ç±»åˆ« (LLMè¿”å›ï¼Œå¦‚"å¥¶èŒ¶")
  String categoryType;       // å¤§ç±» (10é€‰1ï¼Œå¦‚"é¤é¥®")
  String? note;              // å¤‡æ³¨/äº‹ä»¶æè¿°
  String? emoji;             // æƒ…ç»ªè¯æ£€æµ‹åçš„è¡¨æƒ…
  DateTime datetime;         // æ¶ˆè´¹æ—¶é—´
  DateTime createdAt;        // è®°å½•åˆ›å»ºæ—¶é—´
}

// 2. åˆ†ç±»è¡¨ (categories) - åŠ¨æ€ç§¯ç´¯
class Category {
  int id;
  String name;               // åˆ†ç±»å (å¦‚"å¥¶èŒ¶"ã€"å‰§æœ¬æ€")
  String type;               // æ‰€å±å¤§ç±» (å¦‚"é¤é¥®"ã€"å¨±ä¹")
  int usageCount;            // ä½¿ç”¨æ¬¡æ•°ï¼Œç”¨äºç»Ÿè®¡çƒ­é—¨
}

// 3. é¢„ç®—è¡¨ (budgets)
class Budget {
  int id;
  int year;
  int month;
  double amount;             // æœˆé¢„ç®—é‡‘é¢
}

// 4. åŒæ­¥è®°å½•è¡¨ (sync_logs)
class SyncLog {
  int id;
  DateTime syncTime;         // åŒæ­¥æ—¶é—´
  bool success;              // æ˜¯å¦æˆåŠŸ
  String? errorMsg;          // é”™è¯¯ä¿¡æ¯
}
```

### 4.2 LLM è¿”å›ç»“æ„

```json
{
  "valid": true,
  "amount": 25.5,
  "category": "å…³ä¸œç…®å¯ä¹",
  "type": "é¤é¥®",
  "event": "å…¨å®¶ä¹°å…³ä¸œç…®å’Œå¯ä¹",
  "is_expense": true,
  "datetime": "2024-02-07 14:30",
  "missing_field": null
}
```

### 4.3 äº‘ç›˜å¤‡ä»½æ–‡ä»¶æ ¼å¼

```json
{
  "version": 1,
  "appVersion": "1.0.0",
  "exportTime": "2024-02-07T15:00:00+08:00",
  "deviceId": "xxx",
  "budgets": [...],
  "categories": [...],
  "transactions": [...]
}
```

---

## 5. æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 5.1 è¯­éŸ³è®°è´¦å®Œæ•´é“¾è·¯

```
1. ç”¨æˆ·ç‚¹å‡»éº¦å…‹é£
   â†“
2. å…¨å±æµ®çª—å¼¹å‡ºï¼Œå® ç‰©æˆ´è€³æœºå‡èµ·
   â†“
3. æœ¬åœ° ASR å¼€å§‹ç›‘å¬
   â€¢ å®æ—¶æ˜¾ç¤ºæ–‡å­—æ°”æ³¡
   â€¢ é™é»˜ 1.5s è‡ªåŠ¨åœæ­¢
   â†“
4. è°ƒç”¨ DeepSeek API è§£æ
   â€¢ å® ç‰©åŠ¨ç”»ï¼šæ¨çœ¼é•œ/æ•²è®¡ç®—å™¨
   â†“
5. æ ¡éªŒè¿”å› JSON
   â”œâ”€â”€ valid=false â†’ åœºæ™¯3ï¼šæ— æ³•è§£æï¼ŒèŒå® è¿½é—®
   â”œâ”€â”€ missing_field="amount" â†’ åœºæ™¯1ï¼šç¼ºé‡‘é¢ï¼ŒèŒå® è¿½é—®
   â”œâ”€â”€ missing_field="event" â†’ åœºæ™¯2ï¼šç¼ºäº‹ä»¶ï¼ŒèŒå® è¿½é—®
   â”œâ”€â”€ missing_field="time" â†’ åœºæ™¯4ï¼šç¼ºæ—¶é—´ï¼ŒèŒå® è¿½é—®
   â””â”€â”€ ä¿¡æ¯å®Œæ•´ â†’ ç»§ç»­ â†“
   â†“
6. æ˜¾ç¤ºæ”¶é“¶å°ç¥¨ç¡®è®¤å¡
   â€¢ ç”¨æˆ·å¯ç‚¹å‡»ä¿®æ”¹
   â†“
7. ç”¨æˆ·ç‚¹å‡»"ç¡®è®¤/ç›–ç« "
   â€¢ éŸ³æ•ˆï¼šæ”¶é“¶æœºå’”åš“
   â€¢ åŠ¨ç”»ï¼šå°ç¥¨å¸å…¥è´¦æœ¬ï¼Œå® ç‰©æ¯”å¿ƒ
   â†“
8. å†™å…¥ SQLite
   â€¢ æ£€æŸ¥ category æ˜¯å¦ä¸ºæ–°åˆ†ç±»ï¼Œæ˜¯åˆ™å…¥åº“
   â†“
9. åˆ·æ–°é¦–é¡µ & å°ç»„ä»¶
```

### 5.2 é˜¿é‡Œäº‘ç›˜å®šæ—¶åŒæ­¥

```
æ¯å°æ—¶è§¦å‘ (WorkManager / Timer)
   â†“
æ£€æŸ¥ Token æ˜¯å¦æœ‰æ•ˆ
   â”œâ”€â”€ æ— æ•ˆ â†’ é™é»˜è·³è¿‡ï¼Œä¸‹æ¬¡å†è¯•
   â””â”€â”€ æœ‰æ•ˆ â†’ ç»§ç»­ â†“
   â†“
å¯¼å‡ºæœ¬åœ°æ•°æ®ä¸º JSON
   â†“
ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ç›˜ /Apps/èŒå® è´¦æœ¬/backup.json
   â€¢ è¦†ç›–æ¨¡å¼
   â†“
è®°å½• sync_log
```

### 5.3 å® ç‰©çŠ¶æ€è®¡ç®—

```
è§¦å‘æ—¶æœºï¼šé¦–é¡µåŠ è½½ã€è®°è´¦å®Œæˆ
   â†“
è®¡ç®—æœ¬æœˆæ•°æ®
   â€¢ æ€»æ”¯å‡º / æœˆé¢„ç®— = æ¶ˆè€—æ¯”ä¾‹
   â†“
å†³å®šå® ç‰©å¿ƒæƒ…
   â€¢ > 80% å‰©ä½™ â†’ å¼€å¿ƒ (æˆ´å¢¨é•œ)
   â€¢ 50-80% â†’ æ­£å¸¸ (ç©è€)
   â€¢ 20-50% â†’ æ‹…å¿§ (æŒ å¤´)
   â€¢ < 20% â†’ ç„¦è™‘ (ä¸¾ç©ºç¢—)
   â†“
é€‰æ‹©å¯¹åº” Lottie åŠ¨ç”» + èƒŒæ™¯è‰²
```

---

## 6. DeepSeek Prompt è®¾è®¡

### 6.1 System Prompt

```text
ä½ æ˜¯ã€ŒèŒå® è´¦æœ¬ã€çš„è®°è´¦åŠ©æ‰‹ï¼Œè´Ÿè´£ä»ç”¨æˆ·è¯­éŸ³ä¸­æå–è®°è´¦ä¿¡æ¯ã€‚

## è¾“å‡ºæ ¼å¼
ä»…è¿”å› JSONï¼Œä¸è¦ä»»ä½•è§£é‡Šæ–‡å­—ã€‚

## å­—æ®µè¯´æ˜
- valid: boolï¼Œæ˜¯å¦ä¸ºæœ‰æ•ˆçš„è®°è´¦æ„å›¾
- amount: float|nullï¼Œé‡‘é¢ï¼ˆä¸­æ–‡æ•°å­—éœ€è½¬æ¢ï¼šäºŒåäº”å—äº” â†’ 25.5ï¼‰
- category: string|nullï¼Œå…·ä½“æ¶ˆè´¹å†…å®¹ï¼ˆç®€çŸ­ï¼Œå¦‚"å¥¶èŒ¶"ã€"æ‰“è½¦"ï¼‰
- type: string|nullï¼Œæ‰€å±å¤§ç±»ï¼Œåªèƒ½ä»ä»¥ä¸‹é€‰æ‹©ï¼š
  [é¤é¥®, äº¤é€š, è´­ç‰©, å¨±ä¹, ç”Ÿæ´», åŒ»ç–—, ç¾å¦†æŠ¤è‚¤, äººæƒ…ç¤¾äº¤, æ—…è¡Œ, å…¶ä»–]
- event: string|nullï¼Œå®Œæ•´äº‹ä»¶æè¿°
- is_expense: boolï¼Œtrue=æ”¯å‡ºï¼Œfalse=æ”¶å…¥
- datetime: string|nullï¼Œæ¶ˆè´¹æ—¶é—´ï¼ˆä»…å½“ç”¨æˆ·æ˜ç¡®è¯´äº†æ—¶é—´è¯æ‰æå–ï¼‰
- missing_field: "amount"|"event"|"time"|nullï¼Œç¼ºå¤±çš„å¿…è¦å­—æ®µ

## æ—¶é—´æå–è§„åˆ™
- åªæœ‰ç”¨æˆ·æ˜ç¡®è¯´äº†æ—¶é—´è¯æ‰æå–ï¼Œå¦åˆ™ datetime ä¸º null
- æ—¶é—´è¯ç¤ºä¾‹ï¼š"åˆšæ‰"ã€"æ˜¨å¤©"ã€"ä¸Šåˆ"ã€"ä¸­åˆ"ã€"ä¸‰ç‚¹"ã€"æ—©ä¸Šåç‚¹"
- æ²¡æœ‰æ—¶é—´è¯ â†’ datetime: null, missing_field: "time"

## missing_field ä¼˜å…ˆçº§
ç¼ºå¤±å¤šä¸ªå­—æ®µæ—¶ï¼ŒæŒ‰æ­¤é¡ºåºåªè¿”å›ç¬¬ä¸€ä¸ªï¼š
1. amountï¼ˆæœ€é‡è¦ï¼‰
2. event  
3. time

## æ”¶å…¥è¯†åˆ«
ä»¥ä¸‹å…³é”®è¯è¯†åˆ«ä¸ºæ”¶å…¥ï¼ˆis_expense=falseï¼‰ï¼š
- å·¥èµ„ã€å‘å·¥èµ„ã€åˆ°è´¦ â†’ type å›ºå®šä¸º"å·¥èµ„"
- çº¢åŒ…ã€æ”¶åˆ°çº¢åŒ… â†’ type å›ºå®šä¸º"çº¢åŒ…"  
- æŠ¥é”€ â†’ type å›ºå®šä¸º"æŠ¥é”€"
- å…¶ä»–æ”¶å…¥ â†’ type å›ºå®šä¸º"å…¶ä»–"

## ç¤ºä¾‹

è¾“å…¥: "åˆšæ‰åœ¨å…¨å®¶ä¹°äº†å…³ä¸œç…®å’Œå¯ä¹ï¼Œä¸€å…±äºŒåäº”å—äº”"
è¾“å‡º:
{"valid":true,"amount":25.5,"category":"å…³ä¸œç…®å¯ä¹","type":"é¤é¥®","event":"å…¨å®¶ä¹°å…³ä¸œç…®å’Œå¯ä¹","is_expense":true,"datetime":"2024-02-07 14:30","missing_field":null}

è¾“å…¥: "ä¹°å¥¶èŒ¶èŠ±äº†åäº”"
è¾“å‡º:
{"valid":true,"amount":15,"category":"å¥¶èŒ¶","type":"é¤é¥®","event":"ä¹°å¥¶èŒ¶","is_expense":true,"datetime":null,"missing_field":"time"}

è¾“å…¥: "ä¹°äº†æ¯å¥¶èŒ¶"
è¾“å‡º:
{"valid":true,"amount":null,"category":"å¥¶èŒ¶","type":"é¤é¥®","event":"ä¹°å¥¶èŒ¶","is_expense":true,"datetime":null,"missing_field":"amount"}

è¾“å…¥: "èŠ±äº†ä¸€ç™¾äº”"
è¾“å‡º:
{"valid":true,"amount":150,"category":null,"type":null,"event":null,"is_expense":true,"datetime":null,"missing_field":"event"}

è¾“å…¥: "ä»Šå¤©å‘å·¥èµ„äº†ï¼Œåˆ°è´¦å…«åƒ"
è¾“å‡º:
{"valid":true,"amount":8000,"category":"å·¥èµ„","type":"å·¥èµ„","event":"å‘å·¥èµ„","is_expense":false,"datetime":"2024-02-07","missing_field":null}

è¾“å…¥: "å•Šé‚£ä¸ª..."
è¾“å‡º:
{"valid":false,"amount":null,"category":null,"type":null,"event":null,"is_expense":true,"datetime":null,"missing_field":null}
```

### 6.2 è°ƒç”¨å°è£…

```dart
class LLMService {
  Future<LLMResult> parse(String text) async {
    final response = await dio.post(
      'https://ark.cn-beijing.volces.com/api/v3/chat/completions',
      data: {
        'model': 'deepseek-v3',
        'messages': [
          {'role': 'system', 'content': systemPrompt},
          {'role': 'user', 'content': 'current_time: ${DateTime.now()}\nè¾“å…¥: "$text"'}
        ],
        'temperature': 0.1,  // ä½æ¸©åº¦ä¿è¯ç¨³å®šè¾“å‡º
      },
    );
    return LLMResult.fromJson(jsonDecode(response.data['choices'][0]['message']['content']));
  }
}
```

---

## 7. æ™ºèƒ½è¿½é—®æœºåˆ¶

### 7.1 è¿½é—®æ–‡æ¡ˆåº“

```dart
// core/constants/pet_prompts.dart

/// åœºæ™¯1ï¼šç¼ºå¤±é‡‘é¢
const missingAmountPrompts = [
  "æ”¶åˆ°ï¼ä¸è¿‡... è¿™ç¬”'å·¨æ¬¾'å…·ä½“æ˜¯å¤šå°‘å‘€ï¼Ÿ",
  "æœ¬å–µè®°ä¸‹æ¥å•¦ï¼Œä½†æ˜¯ä»·æ ¼é‚£ä¸€æ è¿˜ç©ºç€å‘¢~",
  "æ˜¯ 10 å—è¿˜æ˜¯ 100 å—ï¼Ÿå¿«å‘Šè¯‰æˆ‘ï¼Œæˆ‘è¦ç®—è´¦å•¦ï¼",
];

/// åœºæ™¯2ï¼šç¼ºå¤±äº‹ä»¶
const missingEventPrompts = [
  "150 å…ƒå·²å°±ä½ï¼æ˜¯ä¹°äº†æ¼‚äº®è¡£æœè¿˜æ˜¯å¥½åƒçš„ï¼Ÿ",
  "è¿™ç¬”é’±èŠ±åœ¨å“ªé‡Œäº†å‘€ï¼Ÿæˆ‘çš„ç¬”éƒ½æ€¥å¾—æ²¡å¢¨æ°´å•¦ï¼",
  "å…‰è®°æ•°å­—ä¼šå¿˜æ‰çš„å“¦ï¼Œç»™è¿™ç¬”è´¦èµ·ä¸ªåå­—å§ï¼Ÿ",
];

/// åœºæ™¯3ï¼šæ— æ³•è§£æ
const invalidPrompts = [
  "ä¿¡å·è¢«å¤–æ˜ŸäººåŠ«æŒå•¦ï¼Œæ²¡å¬æ¸…æï¼Œå†è¯´ä¸€éå¥½ä¸å¥½ï¼Ÿ",
  "åˆšæ‰é£å¤ªå¤§ï¼Œæˆ‘æ²¡å¬è§ï¼Œä¸»äººå†è¯´ä¸€æ¬¡å˜›~",
  "æ­ªï¼Ÿæ­ªï¼Ÿè¿™é‡Œæ˜¯èŒå® å°ï¼Œè¯·å†è®²ä¸€é~",
];

/// åœºæ™¯4ï¼šç¼ºå¤±æ—¶é—´
const missingTimePrompts = [
  "è®°ä¸‹æ¥å•¦ï¼è¿™æ˜¯ä»€ä¹ˆæ—¶å€™èŠ±çš„å‘€ï¼Ÿ",
  "è´¦æœ¬ä¸Šæ—¶é—´é‚£æ ç©ºç€å‘¢ï¼Œæ˜¯åˆšæ‰è¿˜æ˜¯ä¹‹å‰å‘€ï¼Ÿ",
  "æ˜¯ä»Šå¤©èŠ±çš„å—ï¼Ÿå‘Šè¯‰æˆ‘å…·ä½“æ—¶é—´å§~",
];

/// äº’åŠ¨å°è¯ï¼ˆç‚¹å‡»å® ç‰©ï¼‰
const petInteractionPrompts = [
  "ä»Šå¤©è¦ç»™æˆ‘ä¹°ç½ç½å—ï¼Ÿ",
  "ä¸»äººä»Šå¤©ä¹Ÿè¦åŠªåŠ›çœé’±å“¦~",
  "æ‘¸æ‘¸å¤´å°±ä¸è®°è´¦äº†å—ï¼Ÿ",
  "å–µ~ æœ‰ä»€ä¹ˆè¦è®°çš„å—ï¼Ÿ",
];
```

### 7.2 å® ç‰©è¿½é—®åŠ¨ç”»

| åœºæ™¯ | åŠ¨ç”» | è¯´æ˜ |
|------|------|------|
| ç¼ºé‡‘é¢ | åŒæ‰‹æ§è®¡ç®—å™¨ï¼Œå±å¹•æ˜¾ç¤º `?` | ç­‰å¾…è¾“å…¥æ•°å­— |
| ç¼ºäº‹ä»¶ | æ‹¿ç€ç¾½æ¯›ç¬”æ‚¬åœï¼ŒæœŸå¾…çœ¼ç¥ | ç­‰å¾…æè¿° |
| ç¼ºæ—¶é—´ | æŒ‡ç€æ‰‹è¡¨/æ—¥å†ï¼Œæ­ªå¤´è¯¢é—® | ç­‰å¾…æ—¶é—´ |
| æ— æ³•è§£æ | è€³æœµè€·æ‹‰ï¼Œåœˆåœˆçœ¼(æ™•å€’çŠ¶) | è¯·æ±‚é‡è¯• |

---

## 8. UI ç»„ä»¶è®¾è®¡

### 8.1 ä¸»é¢˜è‰²æ¿

```dart
// core/theme/colors.dart
class AppColors {
  // é©¬å¡é¾™ä¸»è‰²
  static const cream = Color(0xFFFFF8E7);      // å¥¶æ²¹é»„ - èƒŒæ™¯
  static const sakura = Color(0xFFFFD1DC);     // æ¨±èŠ±ç²‰ - å¼ºè°ƒ
  static const sky = Color(0xFFB5E2FF);        // å¤©ç©ºè“ - è¾…åŠ©
  
  // è¯­ä¹‰è‰²
  static const expense = Color(0xFFFF8B8B);    // æ”¯å‡ºçº¢ï¼ˆæŸ”å’Œï¼‰
  static const income = Color(0xFF7DD9A7);     // æ”¶å…¥ç»¿ï¼ˆæŸ”å’Œï¼‰
  
  // å® ç‰©å¿ƒæƒ…èƒŒæ™¯
  static const moodHappy = Color(0xFFFFF4CC);  // æš–é»„ >80%
  static const moodNormal = Color(0xFFE8F4FF); // æ·¡è“ 50-80%
  static const moodWorry = Color(0xFFFFE8D9);  // æ·¡æ©™ 20-50%
  static const moodSad = Color(0xFFE8E8F0);    // ç°è“ <20%
}
```

### 8.2 é¦–é¡µå¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŠ¶æ€æ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚      â˜€ï¸/ğŸŒ™ (æ˜¼å¤œèƒŒæ™¯)                â”‚
â”‚                                     â”‚
â”‚         ğŸ± å® ç‰©åŠ¨ç”»                  â”‚
â”‚        "ä»Šå¤©è¦ç»™æˆ‘ä¹°ç½ç½å—ï¼Ÿ"         â”‚
â”‚                                     â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•      â”‚  â† é±¼å¹²è¿›åº¦æ¡
â”‚   æœ¬æœˆå£ç²®å‰©ä½™ï¼šÂ¥2,450               â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»Šå¤©                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ”  å…³ä¸œç…®å¯ä¹    ğŸ¾ -25.50 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â˜•  å¥¶èŒ¶          ğŸ¾ -15.00 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  æ˜¨å¤©                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸš—  æ‰“è½¦          ğŸ¾ -32.00 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”            â”‚
â”‚                    â”‚ ğŸ¾â”‚ â† FAB     â”‚
â”‚                    â””â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ğŸ       ğŸ“Š      âš™ï¸               â”‚  â† åº•éƒ¨å¯¼èˆª
â”‚   é¦–é¡µ    ç»Ÿè®¡    è®¾ç½®              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 è¯­éŸ³æµ®çª—å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚ â† åŠé€æ˜é»‘è‰²é®ç½©
â”‚ â–ˆâ–ˆ                              â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ     â”‚ "ä¹°å¥¶èŒ¶èŠ±äº†15å—" â”‚      â–ˆâ–ˆ â”‚ â† å®æ—¶æ–‡å­—æ°”æ³¡
â”‚ â–ˆâ–ˆ     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ              â”‚               â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ         ğŸ± ğŸ§               â–ˆâ–ˆ â”‚ â† æˆ´è€³æœºçš„å® ç‰©
â”‚ â–ˆâ–ˆ        ï½ï½ï½ï½              â–ˆâ–ˆ â”‚ â† å£°æ³¢åŠ¨ç”»
â”‚ â–ˆâ–ˆ                              â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ     â”‚   ğŸ§¾ æ”¶é“¶å°ç¥¨        â”‚  â–ˆâ–ˆ â”‚ â† ç¡®è®¤å¡ç‰‡
â”‚ â–ˆâ–ˆ     â”‚   â° åˆšæ‰ 14:30     â”‚  â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ     â”‚   ğŸ” é¤é¥® / å¥¶èŒ¶    â”‚  â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ     â”‚   ğŸ“ ä¹°å¥¶èŒ¶         â”‚  â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ     â”‚   ğŸ’° Â¥15.00        â”‚  â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ     â”‚                     â”‚  â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ     â”‚  [å–æ¶ˆ]    [ç›–ç« âœ“]  â”‚  â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆ     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â–ˆâ–ˆ â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 å…³é”®ç»„ä»¶è§„æ ¼

| ç»„ä»¶ | åœ†è§’ | ç‰¹æ•ˆ |
|------|------|------|
| å® ç‰©å¡ç‰‡ | 24dp | ç‚¹å‡»éœ‡åŠ¨ + å«å£° |
| æµæ°´åˆ—è¡¨é¡¹ | 16dp | å·¦æ»‘åˆ é™¤ |
| FAB æŒ‰é’® | åœ†å½¢ | æŒ‰ä¸‹ç¼©æ”¾ + éœ‡åŠ¨ |
| ç¡®è®¤å¡ç‰‡ | 20dp | å¼¹å…¥åŠ¨ç”» |
| æ•°å­—é”®ç›˜ | é¡¶éƒ¨ 16dp | æŒ‰é”®æ°”æ³¡éŸ³ |

---

## 9. Android å°ç»„ä»¶è®¾è®¡

### 9.1 å°ç»„ä»¶è§„æ ¼

| å°ºå¯¸ | æ ¼å­ | ç”¨é€” |
|------|------|------|
| å° | 2Ã—2 | ä»Šæ—¥æ”¯å‡º + å® ç‰©å¤´åƒ + éº¦å…‹é£ |
| ä¸­ | 4Ã—2 | ä»Šæ—¥æ”¯å‡º + å® ç‰©åŠ¨å›¾ + éº¦å…‹é£ + æœ€è¿‘ä¸€ç¬” |

### 9.2 å°ç»„ä»¶å¸ƒå±€

**2Ã—2 å°å°ºå¯¸ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»Šæ—¥æ”¯å‡º           â”‚
â”‚  Â¥ 156.50          â”‚
â”‚          ğŸ±   ğŸ¤   â”‚
â”‚         (ç¡è§‰) (æŒ‰é’®)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**4Ã—2 ä¸­å°ºå¯¸ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»Šæ—¥æ”¯å‡º                               â”‚
â”‚  Â¥ 156.50                    ğŸ±   ğŸ¤   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          (ç¡è§‰)      â”‚
â”‚  æœ€è¿‘ï¼šå¥¶èŒ¶ -15.00                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 æŠ€æœ¯å®ç°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Android åŸç”Ÿå±‚ (Kotlin)                              â”‚
â”‚                                                      â”‚
â”‚  PetWidgetProvider.kt                                â”‚
â”‚  â”œâ”€â”€ onUpdate() â†’ ä» SharedPreferences è¯»å–æ•°æ®åˆ·æ–°   â”‚
â”‚  â”œâ”€â”€ onReceive() â†’ ç›‘å¬ç‚¹å‡»äº‹ä»¶                       â”‚
â”‚  â””â”€â”€ ç‚¹å‡»éº¦å…‹é£ â†’ å¯åŠ¨ VoiceActivity                  â”‚
â”‚                                                      â”‚
â”‚  VoiceActivity.kt (é€æ˜å…¨å±)                          â”‚
â”‚  â””â”€â”€ åµŒå…¥ FlutterFragment â†’ æ˜¾ç¤ºè¯­éŸ³æµ®çª—              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘â†“  MethodChannel é€šä¿¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flutter å±‚                                          â”‚
â”‚                                                      â”‚
â”‚  widget_channel.dart                                 â”‚
â”‚  â”œâ”€â”€ updateWidget() â†’ å†™å…¥ SharedPreferences         â”‚
â”‚  â””â”€â”€ triggerWidgetRefresh() â†’ é€šçŸ¥åŸç”Ÿåˆ·æ–°            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.4 æ•°æ®åŒæ­¥

```dart
// æ¯æ¬¡è®°è´¦åè°ƒç”¨
class WidgetService {
  static const _channel = MethodChannel('pet_ledger/widget');
  
  Future<void> updateWidget() async {
    final today = await transactionRepo.getTodayTotal();
    final latest = await transactionRepo.getLatest();
    
    await _channel.invokeMethod('updateWidget', {
      'todayTotal': today,
      'latestCategory': latest?.category,
      'latestAmount': latest?.amount,
    });
  }
}
```

---

## 10. é˜¿é‡Œäº‘ç›˜åŒæ­¥è®¾è®¡

### 10.1 OAuth æˆæƒæµç¨‹

```
1. ç”¨æˆ·åœ¨è®¾ç½®é¡µç‚¹å‡»ã€Œç»‘å®šé˜¿é‡Œäº‘ç›˜ã€
   â†“
2. æ‰“å¼€ WebView / å¤–éƒ¨æµè§ˆå™¨
   URL: https://openapi.alipan.com/oauth/authorize
   ?client_id=xxx
   &redirect_uri=petledger://callback
   &scope=user:base,file:all:read,file:all:write
   â†“
3. ç”¨æˆ·ç™»å½•é˜¿é‡Œäº‘ç›˜å¹¶æˆæƒ
   â†“
4. å›è°ƒ petledger://callback?code=xxx
   â†“
5. App ç”¨ code æ¢å– access_token + refresh_token
   â†“
6. å®‰å…¨å­˜å‚¨ Token (flutter_secure_storage)
   â†“
7. æ˜¾ç¤ºã€Œå·²ç»‘å®šï¼šç”¨æˆ·æ˜µç§°ã€
```

### 10.2 åŒæ­¥æœåŠ¡å®ç°

```dart
class SyncService {
  static const _backupPath = '/Apps/èŒå® è´¦æœ¬/backup.json';
  
  Future<SyncResult> uploadBackup() async {
    // 1. è·å–æœ‰æ•ˆ Token
    final token = await authService.getValidToken();
    if (token == null) return SyncResult.notAuthorized();
    
    // 2. å¯¼å‡ºæœ¬åœ°æ•°æ®
    final data = await _exportData();
    
    // 3. ä¸Šä¼ ï¼ˆå­˜åœ¨åˆ™è¦†ç›–ï¼‰
    await _uploadFile(token, _backupPath, jsonEncode(data));
    
    // 4. è®°å½•æ—¥å¿—
    await syncLogDao.insert(SyncLog(syncTime: DateTime.now(), success: true));
    
    return SyncResult.success();
  }
  
  Future<SyncResult> downloadAndRestore() async {
    // ä¸‹è½½å¹¶æ¢å¤æ•°æ®...
  }
}
```

### 10.3 å®šæ—¶åŒæ­¥è°ƒåº¦

```dart
class SyncScheduler {
  static Future<void> initialize() async {
    await Workmanager().initialize(callbackDispatcher);
    
    await Workmanager().registerPeriodicTask(
      'alipan_sync',
      'uploadBackup',
      frequency: Duration(hours: 1),
      constraints: Constraints(
        networkType: NetworkType.connected,
        requiresBatteryNotLow: true,
      ),
    );
  }
}
```

---

## 11. å®ç°è®¡åˆ’ä¸æ’æœŸ

### 11.1 é˜¶æ®µåˆ’åˆ†

| é˜¶æ®µ | å†…å®¹ | æ—¶é—´ |
|------|------|------|
| Phase 1 | åŸºç¡€æ¡†æ¶ï¼šé¡¹ç›®åˆå§‹åŒ–ã€ä¸»é¢˜ã€æ•°æ®åº“ã€Provider éª¨æ¶ | 3å¤© |
| Phase 2 | é¦–é¡µæ ¸å¿ƒï¼šå® ç‰©å¡ç‰‡ã€Lottieã€è¿›åº¦æ¡ã€æµæ°´åˆ—è¡¨ã€æ‰‹åŠ¨è®°è´¦ | 5å¤© |
| Phase 3 | è¯­éŸ³è®°è´¦ï¼šæœ¬åœ° ASRã€DeepSeekã€è¯­éŸ³æµ®çª—ã€è¿½é—®æµç¨‹ã€éŸ³æ•ˆ | 5å¤© |
| Phase 4 | ç»Ÿè®¡é¡µé¢ï¼šæƒ…ç»ªæ€»è¯„ã€é¥¼å›¾ã€æ’è¡Œæ¦œã€è®¸æ„¿æ±  | 3å¤© |
| Phase 5 | è®¾ç½®é¡µé¢ï¼šé¢„ç®—è®¾ç½®ã€å® ç‰©åˆ‡æ¢ã€å½©è›‹ã€å¯¼å…¥å¯¼å‡º | 2å¤© |
| Phase 6 | é˜¿é‡Œäº‘ç›˜ï¼šOAuthã€Token ç®¡ç†ã€ä¸Šä¼ ä¸‹è½½ã€å®šæ—¶ä»»åŠ¡ | 3å¤© |
| Phase 7 | Android å°ç»„ä»¶ï¼šUIã€MethodChannelã€VoiceActivity | 4å¤© |
| Phase 8 | æ‰“ç£¨ä¼˜åŒ–ï¼šåŠ¨ç”»ç»†èŠ‚ã€éœ‡åŠ¨åé¦ˆã€è¾¹ç•Œå¤„ç†ã€æµ‹è¯• | 3å¤© |
| **æ€»è®¡** | | **çº¦ 28 å¤© (4å‘¨)** |

### 11.2 ä¾èµ–åº“æ¸…å•

```yaml
dependencies:
  flutter_riverpod: ^2.5.1      # çŠ¶æ€ç®¡ç†
  drift: ^2.15.0                # æ•°æ®åº“
  dio: ^5.4.0                   # ç½‘ç»œ
  flutter_secure_storage: ^9.0.0
  speech_to_text: ^6.6.0        # è¯­éŸ³è¯†åˆ«
  lottie: ^3.1.0                # åŠ¨ç”»
  fl_chart: ^0.66.0             # é¥¼å›¾
  audioplayers: ^5.2.1          # éŸ³æ•ˆ
  vibration: ^1.8.4             # éœ‡åŠ¨
  home_widget: ^0.4.1           # å°ç»„ä»¶
  workmanager: ^0.5.2           # åå°ä»»åŠ¡
```

### 11.3 ç´ ææ¸…å•

| ç±»å‹ | å†…å®¹ | æ¥æºå»ºè®® |
|------|------|----------|
| Lottie åŠ¨ç”» | çŒ«/ç‹—/å…” Ã— 6çŠ¶æ€ | LottieFiles å…è´¹ç´ æ |
| åˆ†ç±»å›¾æ ‡ | 10ä¸ªå¤§ç±»å›¾æ ‡ (æ‰‹ç»˜é£) | Flaticon / è‡ªç»˜ |
| éŸ³æ•ˆ | æ°”æ³¡éŸ³ã€æ”¶é“¶æœºã€å–µå«ã€æ±ªå« | Freesound |
| å­—ä½“ | åœ†æ¶¦å¯çˆ±å­—ä½“ | ç«™é…·å¿«ä¹ä½“ (å…è´¹å•†ç”¨) |

### 11.4 å¼€å‘ä¼˜å…ˆçº§

**å¿…é¡»æœ‰ (MVP):**
- é¦–é¡µ + æ‰‹åŠ¨è®°è´¦
- è¯­éŸ³è®°è´¦ + LLM è§£æ
- æœ¬åœ°å­˜å‚¨
- å® ç‰©åŸºç¡€åŠ¨ç”»

**åº”è¯¥æœ‰ (v1.0):**
- ç»Ÿè®¡é¡µé¢
- é˜¿é‡Œäº‘ç›˜åŒæ­¥
- Android å°ç»„ä»¶
- æ™ºèƒ½è¿½é—®

**å¯ä»¥æœ‰ (v1.1+):**
- å® ç‰©æ¢è£…ç³»ç»Ÿ
- è®¸æ„¿æ± 
- è¿ç»­è®°è´¦å¥–åŠ±
- æ›´å¤šå® ç‰©åŠ¨ç”»

---

## é™„å½•ï¼šåˆ†ç±»å›¾æ ‡æ˜ å°„

| å¤§ç±» | å›¾æ ‡ | æ¶µç›–ç¤ºä¾‹ |
|------|------|----------|
| é¤é¥® | ğŸ” | å¥¶èŒ¶ã€å¤–å–ã€ç«é”…ã€é›¶é£Ÿ |
| äº¤é€š | ğŸš— | æ‰“è½¦ã€åŠ æ²¹ã€åœ°é“ã€åœè½¦ |
| è´­ç‰© | ğŸ›ï¸ | è¡£æœã€æ—¥ç”¨å“ã€æ•°ç  |
| å¨±ä¹ | ğŸ® | ç”µå½±ã€æ¸¸æˆã€å‰§æœ¬æ€ã€KTV |
| ç”Ÿæ´» | ğŸ  | æˆ¿ç§Ÿã€æ°´ç”µã€è¯è´¹ã€ç‰©ä¸š |
| åŒ»ç–— | ğŸ’Š | çœ‹ç—…ã€ä¹°è¯ã€ä½“æ£€ |
| ç¾å¦†æŠ¤è‚¤ | ğŸ’„ | åŒ–å¦†å“ã€æŠ¤è‚¤å“ã€ç¾ç”² |
| äººæƒ…ç¤¾äº¤ | ğŸ | é€ç¤¼ã€çº¢åŒ…ã€è¯·å®¢ |
| æ—…è¡Œ | âœˆï¸ | æœºç¥¨ã€é…’åº—ã€é—¨ç¥¨ã€æ—…æ¸¸è´­ç‰© |
| å…¶ä»– | ğŸ“ | æ— æ³•å½’ç±»çš„æ¶ˆè´¹ |
